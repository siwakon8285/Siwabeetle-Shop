<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Siwabeetle Shop | ร้านขายด้วงและอุปกรณ์คุณภาพ</title>
    <meta name="description" content="จำหน่ายด้วงกว่าง ด้วงคีม ตัวอ่อน และอุปกรณ์การเลี้ยงคุณภาพสูง ในราคาเป็นกันเอง">

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="images/unnamed (1).jpg">
    <link rel="shortcut icon" href="images/unnamed (1).jpg">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700;800&family=Prompt:wght@200;300;400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <link rel="stylesheet" href="index.css">
</head>

<body>
    <header id="main-header">
        <div class="container nav-content">
            <a href="#" class="logo">
                <i class="fa-solid fa-beetle"></i>
                <span>SIWABEETLES</span>
            </a>
            <div class="nav-actions">
                <!-- Search Bar -->
                <div class="search-wrapper" id="search-wrapper">
                    <input type="text" id="search-input" placeholder="ค้นหาสินค้า..." />
                    <div class="search-results" id="search-results"></div>
                </div>
                <button class="nav-btn search-toggle-btn" id="search-toggle" title="ค้นหา">
                    <i class="fa-solid fa-magnifying-glass"></i>
                </button>
                <!-- Wishlist Button -->
                <button class="nav-btn wishlist-btn" id="wishlist-trigger" title="รายการโปรด">
                    <i class="fa-solid fa-heart"></i>
                    <span class="wishlist-badge" id="wishlist-count">0</span>
                </button>
                <button class="nav-btn" id="login-trigger" title="ข้อมูลผู้ส่ง">
                    <i class="fa-solid fa-user"></i>
                </button>
                <button class="cart-icon-btn" id="cart-trigger">
                    <i class="fa-solid fa-basket-shopping"></i>
                    <span class="cart-badge" id="cart-count">0</span>
                </button>
            </div>
        </div>
    </header>

    <main>
        <section class="hero">

            <div class="hero-content">
                <h1>สัมผัสความงามแห่งธรรมชาติ</h1>
                <p>แหล่งรวบรวมด้วงสายพันธุ์หายาก และอุปกรณ์การเลี้ยงครบวงจร</p>
                <a href="#shop" class="btn-primary">เลือกชมสินค้า</a>
            </div>
        </section>

        <section class="container" id="shop">
            <div class="filters" id="category-filters">
                <button class="filter-btn active" data-category="all">ทั้งหมด</button>
                <button class="filter-btn" data-category="adult">เต็มวัย</button>
                <button class="filter-btn" data-category="larva">ตัวอ่อน</button>
                <button class="filter-btn" data-category="set">ชุดเซ็ต</button>
                <button class="filter-btn" data-category="accessory">อุปกรณ์</button>
            </div>

            <div class="product-grid" id="product-container">
                <!-- Products will be injected here by JS -->
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <div class="footer-logo">
                <i class="fa-solid fa-beetle"></i> SIWABEETLE SHOP
            </div>
            <p>
                <i class="fa-brands fa-facebook"></i> Facebook: <a href="https://www.facebook.com/siwakorn.bunde.2024"
                    target="_blank" style="color: var(--light-moss); text-decoration: none;">Siwakorn Bunde</a>
            </p>
            <div class="copyright">
                &copy; 2026 Siwabeetle Shop. All rights reserved.
            </div>
        </div>
    </footer>

    <!-- Cart Modal -->
    <div class="modal" id="cart-modal">
        <div class="cart-sidebar">
            <div class="cart-header">
                <h2>ตะกร้าของคุณ</h2>
                <button class="close-cart" id="close-cart">&times;</button>
            </div>
            <div class="cart-items" id="cart-items-container">
                <!-- Cart items will be injected here -->
            </div>
            <div class="cart-footer">
                <div class="cart-summary-row">
                    <span>ยอดรวมสินค้า:</span>
                    <span><span id="cart-subtotal">0</span> บาท</span>
                </div>
                <div class="cart-summary-row shipping-row">
                    <span>ค่าจัดส่ง:</span>
                    <span>100 บาท</span>
                </div>
                <div class="cart-total">
                    <span>ยอดรวมทั้งหมด:</span>
                    <span><span id="cart-total-amount">0</span> บาท</span>
                </div>
                <button class="btn-primary checkout-btn" onclick="openPayment()">
                    <i class="fa-solid fa-qrcode"></i> ชำระเงินด้วย PromptPay
                </button>
            </div>
        </div>
    </div>

    <!-- Login/Registration Modal -->
    <div class="modal" id="login-modal">
        <div class="glass registration-form">
            <div class="cart-header">
                <h2 id="modal-title">เข้าสู่ระบบ</h2>
                <button class="close-cart" id="close-login">&times;</button>
            </div>

            <!-- Login Form -->
            <form id="login-form">
                <div class="form-group">
                    <label for="login-email">Email <span class="required">*</span></label>
                    <input type="email" id="login-email" required placeholder="example@email.com">
                </div>
                <div class="form-group">
                    <label for="login-password">Password <span class="required">*</span></label>
                    <div class="password-input-wrapper">
                        <input type="password" id="login-password" required placeholder="••••••••">
                        <button type="button" class="toggle-password"
                            onclick="togglePasswordVisibility('login-password', this)">
                            <i class="fa-solid fa-eye"></i>
                        </button>
                    </div>
                </div>
                <button type="submit" class="btn-primary" style="width: 100%; margin-top: 10px;">เข้าสู่ระบบ</button>
                <p style="text-align: center; margin-top: 15px; font-size: 0.9rem;">
                    <a href="#" id="forgot-password-link"
                        style="color: var(--light-moss); text-decoration: none; opacity: 0.8;">ลืมรหัสผ่าน?</a>
                </p>
                <p style="text-align: center; margin-top: 10px; font-size: 0.9rem;">
                    ยังไม่มีบัญชี? <a href="#" id="go-to-register"
                        style="color: var(--light-moss); text-decoration: none; font-weight: 600;">สมัครสมาชิก</a>
                </p>
            </form>

            <!-- Register Form (Hidden by default) -->
            <form id="register-form" style="display: none;">
                <div class="form-group">
                    <label for="reg-username">Username <span class="required">*</span></label>
                    <input type="text" id="reg-username" required placeholder="ตั้งชื่อผู้ใช้งาน">
                </div>
                <div class="form-group">
                    <label for="reg-email">Email <span class="required">*</span></label>
                    <input type="email" id="reg-email" required placeholder="example@email.com">
                </div>
                <div class="form-group">
                    <label for="reg-password">Password <span class="required">*</span></label>
                    <div class="password-input-wrapper">
                        <input type="password" id="reg-password" required placeholder="••••••••">
                        <button type="button" class="toggle-password"
                            onclick="togglePasswordVisibility('reg-password', this)">
                            <i class="fa-solid fa-eye"></i>
                        </button>
                    </div>
                </div>
                <button type="submit" class="btn-primary" style="width: 100%; margin-top: 10px;">สมัครสมาชิก</button>
                <p style="text-align: center; margin-top: 15px; font-size: 0.9rem;">
                    มีบัญชีอยู่แล้ว? <a href="#" id="go-to-login"
                        style="color: var(--light-moss); text-decoration: none; font-weight: 600;">เข้าสู่ระบบ</a>
                </p>
            </form>
            <!-- Profile View (Hidden by default) -->
            <div id="profile-view" style="display: none;" class="profile-card-premium">
                <div class="profile-cover"></div>

                <div class="profile-content-body">
                    <div class="profile-avatar-premium-wrapper">
                        <div class="profile-avatar-inner">
                            <img id="profile-avatar-img" src="images/beetle_avatar.png" alt="Beetle Avatar">
                        </div>
                        <button class="change-avatar-floating" onclick="toggleAvatarSelection()" title="เปลี่ยนอวตาร์">
                            <i class="fa-solid fa-camera"></i>
                        </button>
                    </div>

                    <div id="avatar-selection" class="avatar-selection-panel"
                        style="display: none; margin-bottom: 25px; background: rgba(0,0,0,0.3); padding: 20px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1); box-shadow: inset 0 0 20px rgba(0,0,0,0.5);">
                        <p
                            style="font-size: 0.85rem; margin-bottom: 15px; color: var(--light-moss); font-weight: 600; text-transform: uppercase; letter-spacing: 1px;">
                            เลือกตัวตนของคุณ</p>
                        <div class="avatar-grid"
                            style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                            <img src="images/beetle_avatar.png" class="avatar-option"
                                onclick="selectAvatar('images/beetle_avatar.png')">
                            <img src="images/beetle_avatar_1.png" class="avatar-option"
                                onclick="selectAvatar('images/beetle_avatar_1.png')">
                            <img src="images/beetle_avatar_2.png" class="avatar-option"
                                onclick="selectAvatar('images/beetle_avatar_2.png')">
                            <img src="images/beetle_avatar_3.png" class="avatar-option"
                                onclick="selectAvatar('images/beetle_avatar_3.png')">
                            <img src="images/beetle_avatar_4.png" class="avatar-option"
                                onclick="selectAvatar('images/beetle_avatar_4.png')">
                            <img src="images/beetle_avatar_5.png" class="avatar-option"
                                onclick="selectAvatar('images/beetle_avatar_5.png')">
                        </div>
                    </div>

                    <div class="profile-username-container" style="justify-content: center; margin-bottom: 5px;">
                        <h3 id="profile-username-display"
                            style="font-size: 1.8rem; font-weight: 900; color: var(--white); text-shadow: 0 4px 10px rgba(0,0,0,0.5);">
                        </h3>
                        <button class="edit-name-btn" onclick="toggleEditUsername()"
                            style="margin-left: 10px; background: rgba(255,255,255,0.1);">
                            <i class="fa-solid fa-pen-nib"></i>
                        </button>
                    </div>
                    <p id="profile-email-display"
                        style="color: var(--light-moss); font-size: 0.9rem; opacity: 0.8; margin-bottom: 25px;"></p>

                    <div id="edit-username-group" class="edit-name-input-group"
                        style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 16px; border: 1px solid var(--glass-border);">
                        <div class="form-group" style="margin-bottom: 15px;">
                            <label style="font-size: 0.85rem; opacity: 0.7;">ชื่อผู้ใช้งานใหม่</label>
                            <input type="text" id="new-username-input" placeholder="กรอกชื่อใหม่"
                                style="width: 100%; background: rgba(0,0,0,0.3);">
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn-primary" onclick="updateUsername()"
                                style="flex: 2; height: 45px; font-size: 0.9rem;">ยืนยันการเปลี่ยน</button>
                            <button class="btn-primary" onclick="toggleEditUsername()"
                                style="flex: 1; height: 45px; font-size: 0.9rem; background: rgba(255,255,255,0.1); border: 1px solid var(--glass-border);">ยกเลิก</button>
                        </div>
                    </div>

                    <div class="profile-info-grid">
                        <div class="info-card-premium">
                            <div class="info-card-header">
                                <i class="fa-solid fa-truck-fast"></i> ข้อมูลการจัดส่ง
                            </div>
                            <div class="info-card-content" id="delivery-info-content">
                                <p style="opacity: 0.6; font-style: italic;">ยังไม่ได้ระบุที่อยู่สำหรับจัดส่ง</p>
                            </div>
                            <button class="btn-premium-action btn-edit-premium" style="width: 100%; margin-top: 15px;"
                                onclick="window.openDeliveryForm()">
                                <i class="fa-solid fa-map-location-dot"></i> แก้ไขข้อมูลที่อยู่
                            </button>
                        </div>

                        <!-- Order History Section -->
                        <div class="info-card-premium" style="margin-top: 15px;">
                            <div class="info-card-header">
                                <i class="fa-solid fa-receipt"></i> ประวัติการสั่งซื้อ
                            </div>
                            <div class="info-card-content" id="order-history-content">
                                <p style="opacity: 0.6; font-style: italic;">ยังไม่มีประวัติการสั่งซื้อ</p>
                            </div>
                            <button class="btn-premium-action"
                                style="width: 100%; margin-top: 15px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);"
                                onclick="window.loadOrderHistory()">
                                <i class="fa-solid fa-rotate"></i> โหลดประวัติใหม่
                            </button>
                        </div>
                    </div>

                    <div class="profile-action-btns">
                        <button id="admin-access-btn" class="btn-premium-action"
                            style="display: none; background: var(--grad-gold); color: var(--deep-forest); border: none;"
                            onclick="window.toggleAdminLogin()">
                            <i class="fa-solid fa-crown"></i> แผงควบคุมร้านค้า
                        </button>

                        <button class="btn-premium-action btn-logout-premium" onclick="window.handleLogout()">
                            <i class="fa-solid fa-power-off"></i> ออกจากระบบ
                        </button>

                        <button
                            style="background: transparent; border: none; color: rgba(255,100,100,0.4); font-size: 0.75rem; text-decoration: underline; cursor: pointer; margin-top: 10px;"
                            onclick="window.handleDeleteAccount()">
                            ลบบัญชีผู้ใช้ถาวร
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Delivery Info Modal -->
    <div class="modal" id="delivery-modal">
        <div class="glass registration-form">
            <div class="cart-header">
                <h2>ข้อมูลจัดส่ง</h2>
                <button class="close-cart" id="close-delivery">&times;</button>
            </div>
            <form id="delivery-form">
                <div class="form-group">
                    <label for="delivery-name">ชื่อ-นามสกุล <span class="required">*</span></label>
                    <input type="text" id="delivery-name" required placeholder="ชื่อ นามสกุล">
                </div>
                <div class="form-group">
                    <label for="delivery-phone">เบอร์โทรศัพท์ <span class="required">*</span></label>
                    <input type="tel" id="delivery-phone" required placeholder="08x-xxx-xxxx">
                </div>
                <div class="form-group">
                    <label for="delivery-address">ที่อยู่จัดส่ง <span class="required">*</span></label>
                    <textarea id="delivery-address" required
                        placeholder="บ้านเลขที่ ถนน แขวง/ตำบล เขต/อำเภอ จังหวัด รหัสไปรษณีย์"></textarea>
                </div>
                <div class="form-group">
                    <label for="delivery-note">รายละเอียดเพิ่มเติม (ถ้ามี) </label>
                    <textarea id="delivery-note" placeholder="เช่น ต้องการส่งสอบถาม หรือ แจ้งปัญหา"></textarea>
                </div>
                <button type="submit" class="btn-primary" style="width: 100%; margin-top: 10px;">
                    <i class="fa-solid fa-check"></i> บันทึกข้อมูล
                </button>
            </form>
        </div>
    </div>

    <!-- Admin Modal -->
    <div class="modal" id="admin-modal">
        <div class="glass registration-form" style="max-width: 600px; max-height: 90vh; overflow-y: auto;">
            <div class="cart-header">
                <h2>จัดการสต็อกสินค้า</h2>
                <button class="close-cart" id="close-admin" onclick="closeAdminModal()">&times;</button>
            </div>
            <div id="admin-product-list" class="admin-product-list">
                <!-- Stock inputs will be injected here -->
            </div>
            <div class="cart-footer">
                <button class="btn-primary" id="save-stock-btn" onclick="saveStock()"
                    style="width: 100%;">บันทึกข้อมูล</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <!-- Hidden Admin Login Trigger Button (Faint Gear Icon) -->
    <button id="admin-trigger" onclick="toggleAdminLogin()" title="Admin" style="display: none;">
        <i class="fa-solid fa-gear"></i>
    </button>

    <!-- Admin Login Modal (Removed as per user request, bypassing via profile now) -->



    <div class="modal" id="payment-modal">
        <div class="glass registration-form">

            <div class="cart-header">
                <h2>ชำระเงินด้วย PromptPay</h2>
                <button class="close-cart" onclick="closePayment()">×</button>
            </div>

            <img src="images/04e5eb92-d450-422e-b525-4149d8d04dd8.jpg" alt="PromptPay QR" class="promptpay-qr" />
            <img id="qr-image" class="qr-img">

            <p class="payment-name">
                ชื่อบัญชี: นายศิวกร บุณดี (PromptPay)
            </p>

            <p class="payment-amount">
                ยอดชำระทั้งหมด:
                <span id="total-amount"></span> บาท
            </p>

            <div class="payment-warning">
                <i class="fa-solid fa-triangle-exclamation"></i>
                <span>กรุณาชำระยอดเงินด้วย PromptPay ให้เรียบร้อยก่อนกดยืนยันการชำระเงิน</span>
            </div>

            <button class="filter-btn" style="width:100%; margin-top:15px" onclick="downloadQR()">
                <i class="fa-solid fa-download"></i> บันทึกรูป QR Code
            </button>

            <button class="btn-primary" style="width:100%; margin-top:15px" onclick="confirmPayment()">
                ยืนยันการชำระเงินที่ Facebook
            </button>

        </div>
    </div>

    <!-- Wishlist Modal -->
    <div class="modal" id="wishlist-modal">
        <div class="cart-sidebar wishlist-sidebar">
            <div class="cart-header">
                <h2><i class="fa-solid fa-heart" style="color: #ff6b6b;"></i> รายการโปรด</h2>
                <button class="close-cart" id="close-wishlist">&times;</button>
            </div>
            <div class="cart-items" id="wishlist-items-container">
                <!-- Wishlist items will be injected here -->
            </div>
        </div>
    </div>

    <!-- Stock Notification Modal -->
    <div class="modal" id="notify-modal">
        <div class="glass registration-form" style="max-width: 420px;">
            <div class="cart-header">
                <h2><i class="fa-solid fa-bell" style="color: var(--dappled-gold);"></i> แจ้งเตือนสินค้า</h2>
                <button class="close-cart" id="close-notify">&times;</button>
            </div>
            <div style="padding: 25px;">
                <p id="notify-product-name"
                    style="font-weight: 700; font-size: 1.1rem; margin-bottom: 20px; color: var(--white);"></p>
                <p style="color: var(--light-moss); margin-bottom: 20px; font-size: 0.9rem;">
                    เราจะส่งอีเมลแจ้งเตือนเมื่อสินค้านี้กลับมาพร้อมจำหน่าย</p>
                <div class="form-group">
                    <label for="notify-email">อีเมลของคุณ <span class="required">*</span></label>
                    <input type="email" id="notify-email" placeholder="example@email.com" />
                </div>
                <button class="btn-primary" onclick="window.submitStockNotification()"
                    style="width: 100%; margin-top: 20px;">
                    <i class="fa-solid fa-bell"></i> ตั้งค่าแจ้งเตือน
                </button>
            </div>
        </div>
    </div>

    <!-- Order Detail Modal -->
    <div class="modal" id="order-detail-modal">
        <div class="glass registration-form" style="max-width: 550px;">
            <div class="cart-header">
                <h2><i class="fa-solid fa-receipt" style="color: var(--light-moss);"></i> รายละเอียดคำสั่งซื้อ</h2>
                <button class="close-cart" id="close-order-detail">&times;</button>
            </div>
            <div id="order-detail-content">
                <!-- Order details will be injected here -->
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>



    <script src="app.js"></script>

</body>

</html>