{
    "rules": {
        "products": {
            ".read": true,
            ".write": "auth != null && root.child('admins').child(auth.uid).exists()",
            "$productId": {
                "stock": {
                    ".write": "auth != null && newData.isNumber() && newData.val() >= 0 && (newData.val() == data.val() - 1 || newData.val() == data.val() + 1 || root.child('admins').child(auth.uid).exists())",
                    ".validate": "newData.isNumber() && newData.val() >= 0"
                }
            }
        },
        "users": {
            "$uid": {
                ".read": "auth != null && auth.uid == $uid",
                ".write": "auth != null && auth.uid == $uid",
                "orders": {
                    ".read": "auth != null && auth.uid == $uid",
                    ".write": "auth != null && auth.uid == $uid",
                    ".indexOn": [
                        "createdAt"
                    ]
                }
            }
        },
        "orders": {
            ".read": "auth != null && root.child('admins').child(auth.uid).exists()",
            ".indexOn": [
                "createdAt",
                "userId"
            ],
            "$orderId": {
                ".read": "auth != null && (data.child('userId').val() == auth.uid || root.child('admins').child(auth.uid).exists())",
                ".write": "auth != null && (!data.exists() || data.child('userId').val() == auth.uid)",
                ".validate": "newData.hasChildren(['orderId', 'userId', 'items', 'total', 'createdAt'])"
            }
        },
        "admins": {
            ".read": "auth != null",
            ".write": false
        }
    }
}